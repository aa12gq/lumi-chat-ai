{"version":3,"file":"main.js","sources":["../electron/main.ts"],"sourcesContent":["const { app, BrowserWindow, Menu } = require('electron');\nconst path = require('path');\n\nfunction createWindow() {\n  const mainWindow = new BrowserWindow({\n    width: 1200,\n    height: 800,\n    webPreferences: {\n      nodeIntegration: false,\n      contextIsolation: true,\n      preload: path.join(__dirname, 'preload.js'),\n      webSecurity: true,\n      sandbox: true,\n    },\n  });\n\n  // 设置 CSP\n  mainWindow.webContents.session.webRequest.onHeadersReceived((details, callback) => {\n    callback({\n      responseHeaders: {\n        ...details.responseHeaders,\n        'Content-Security-Policy': [\n          \"default-src 'self'\",\n          \"script-src 'self' 'unsafe-inline' 'unsafe-eval'\",\n          \"style-src 'self' 'unsafe-inline'\",\n          \"img-src 'self' data: https:\",\n          \"font-src 'self' data:\",\n          \"connect-src 'self' ws://localhost:* http://localhost:*\",\n        ].join('; '),\n      },\n    });\n  });\n\n  // 设置菜单\n  const template = [\n    {\n      label: '文件',\n      submenu: [\n        {\n          label: '新建对话',\n          accelerator: 'CmdOrCtrl+N',\n          click: () => {\n            // 实现新建对话功能\n          },\n        },\n        { type: 'separator' },\n        {\n          label: '退出',\n          accelerator: process.platform === 'darwin' ? 'Command+Q' : 'Alt+F4',\n          click: () => app.quit(),\n        },\n      ],\n    },\n    {\n      label: '编辑',\n      submenu: [\n        { label: '撤销', role: 'undo' },\n        { label: '重做', role: 'redo' },\n        { type: 'separator' },\n        { label: '剪切', role: 'cut' },\n        { label: '复制', role: 'copy' },\n        { label: '粘贴', role: 'paste' },\n      ],\n    },\n    {\n      label: '视图',\n      submenu: [\n        { label: '重新加载', role: 'reload' },\n        { label: '强制重新加载', role: 'forceReload' },\n        { type: 'separator' },\n        { label: '实际大小', role: 'resetZoom' },\n        { label: '放大', role: 'zoomIn' },\n        { label: '缩小', role: 'zoomOut' },\n        { type: 'separator' },\n        { label: '全屏', role: 'togglefullscreen' },\n      ],\n    },\n  ];\n\n  const menu = Menu.buildFromTemplate(template);\n  Menu.setApplicationMenu(menu);\n\n  // 加载应用\n  if (app.isPackaged) {\n    mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));\n  } else {\n    // 开发模式下等待开发服务器启动\n    const loadURL = async () => {\n      try {\n        await mainWindow.loadURL('http://localhost:5173');\n        mainWindow.webContents.openDevTools();\n      } catch (e) {\n        console.error('Failed to load URL:', e);\n        // 如果加载失败，等待一秒后重试\n        setTimeout(loadURL, 1000);\n      }\n    };\n    loadURL();\n  }\n}\n\n// 应用准备就绪时创建窗口\napp.whenReady().then(() => {\n  createWindow();\n\n  app.on('activate', () => {\n    if (BrowserWindow.getAllWindows().length === 0) {\n      createWindow();\n    }\n  });\n});\n\n// 关闭所有窗口时退出应用\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n}); "],"names":[],"mappings":";AAAA,MAAM,EAAE,KAAK,eAAe,KAAK,IAAI,QAAQ,UAAU;AACvD,MAAM,OAAO,QAAQ,MAAM;AAE3B,SAAS,eAAe;AAChB,QAAA,aAAa,IAAI,cAAc;AAAA,IACnC,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,gBAAgB;AAAA,MACd,iBAAiB;AAAA,MACjB,kBAAkB;AAAA,MAClB,SAAS,KAAK,KAAK,WAAW,YAAY;AAAA,MAC1C,aAAa;AAAA,MACb,SAAS;AAAA,IAAA;AAAA,EACX,CACD;AAGD,aAAW,YAAY,QAAQ,WAAW,kBAAkB,CAAC,SAAS,aAAa;AACxE,aAAA;AAAA,MACP,iBAAiB;AAAA,QACf,GAAG,QAAQ;AAAA,QACX,2BAA2B;AAAA,UACzB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF,EAAE,KAAK,IAAI;AAAA,MAAA;AAAA,IACb,CACD;AAAA,EAAA,CACF;AAGD,QAAM,WAAW;AAAA,IACf;AAAA,MACE,OAAO;AAAA,MACP,SAAS;AAAA,QACP;AAAA,UACE,OAAO;AAAA,UACP,aAAa;AAAA,UACb,OAAO,MAAM;AAAA,UAAA;AAAA,QAGf;AAAA,QACA,EAAE,MAAM,YAAY;AAAA,QACpB;AAAA,UACE,OAAO;AAAA,UACP,aAAa,QAAQ,aAAa,WAAW,cAAc;AAAA,UAC3D,OAAO,MAAM,IAAI,KAAK;AAAA,QAAA;AAAA,MACxB;AAAA,IAEJ;AAAA,IACA;AAAA,MACE,OAAO;AAAA,MACP,SAAS;AAAA,QACP,EAAE,OAAO,MAAM,MAAM,OAAO;AAAA,QAC5B,EAAE,OAAO,MAAM,MAAM,OAAO;AAAA,QAC5B,EAAE,MAAM,YAAY;AAAA,QACpB,EAAE,OAAO,MAAM,MAAM,MAAM;AAAA,QAC3B,EAAE,OAAO,MAAM,MAAM,OAAO;AAAA,QAC5B,EAAE,OAAO,MAAM,MAAM,QAAQ;AAAA,MAAA;AAAA,IAEjC;AAAA,IACA;AAAA,MACE,OAAO;AAAA,MACP,SAAS;AAAA,QACP,EAAE,OAAO,QAAQ,MAAM,SAAS;AAAA,QAChC,EAAE,OAAO,UAAU,MAAM,cAAc;AAAA,QACvC,EAAE,MAAM,YAAY;AAAA,QACpB,EAAE,OAAO,QAAQ,MAAM,YAAY;AAAA,QACnC,EAAE,OAAO,MAAM,MAAM,SAAS;AAAA,QAC9B,EAAE,OAAO,MAAM,MAAM,UAAU;AAAA,QAC/B,EAAE,MAAM,YAAY;AAAA,QACpB,EAAE,OAAO,MAAM,MAAM,mBAAmB;AAAA,MAAA;AAAA,IAC1C;AAAA,EAEJ;AAEM,QAAA,OAAO,KAAK,kBAAkB,QAAQ;AAC5C,OAAK,mBAAmB,IAAI;AAG5B,MAAI,IAAI,YAAY;AAClB,eAAW,SAAS,KAAK,KAAK,WAAW,oBAAoB,CAAC;AAAA,EAAA,OACzD;AAEL,UAAM,UAAU,YAAY;AACtB,UAAA;AACI,cAAA,WAAW,QAAQ,uBAAuB;AAChD,mBAAW,YAAY,aAAa;AAAA,eAC7B,GAAG;AACF,gBAAA,MAAM,uBAAuB,CAAC;AAEtC,mBAAW,SAAS,GAAI;AAAA,MAAA;AAAA,IAE5B;AACQ,YAAA;AAAA,EAAA;AAEZ;AAGA,IAAI,UAAA,EAAY,KAAK,MAAM;AACZ,eAAA;AAET,MAAA,GAAG,YAAY,MAAM;AACvB,QAAI,cAAc,gBAAgB,WAAW,GAAG;AACjC,mBAAA;AAAA,IAAA;AAAA,EACf,CACD;AACH,CAAC;AAGD,IAAI,GAAG,qBAAqB,MAAM;AAC5B,MAAA,QAAQ,aAAa,UAAU;AACjC,QAAI,KAAK;AAAA,EAAA;AAEb,CAAC;"}